<style>
  #global-loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(10, 10, 10, 0.7);
      backdrop-filter: blur(4px);
      z-index: 99999;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      
      transition: opacity 0.15s ease-out, visibility 0.15s;
      opacity: 1;
      visibility: visible;
  }

  .loader-spinner {
      width: 35px;
      height: 35px;
      border: 3px solid rgba(255, 215, 0, 0.1);
      border-top: 3px solid #FFD700;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-bottom: 10px;
      box-shadow: 0 0 10px rgba(255, 215, 0, 0.1);
  }

  .loader-text {
      color: #FFD700;
      font-family: 'Segoe UI', sans-serif;
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      text-shadow: 0 2px 4px rgba(0,0,0,0.8);
      animation: pulse 1.5s infinite;
  }

  .loader-hidden {
      opacity: 0 !important;
      visibility: hidden !important;
      pointer-events: none;
  }

  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  @keyframes pulse { 0% { opacity: 0.7; } 50% { opacity: 1; } 100% { opacity: 0.7; } }
</style>

<div id="global-loader">
  <div class="loader-spinner"></div>
  <div class="loader-text">Loading...</div>
</div>

<script>

  function hideLoader() {
      const loader = document.getElementById('global-loader');
      if (loader && !loader.classList.contains('loader-hidden')) {
          loader.classList.add('loader-hidden');
      }
  }

  if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', hideLoader);
  } else {
      hideLoader();
  }
  
  window.addEventListener('pageshow', function(event) {
      if (event.persisted) hideLoader();
  });


  document.addEventListener('click', function(e) {
      const link = e.target.closest('a');
      if (!link) return;

      const href = link.getAttribute('href');
      if (!href || href.startsWith('#') || href.startsWith('javascript:') || link.target === '_blank') return;

      const criticalPaths = ['/login', '/signup', '/dashboard', '/logout'];
      
      const isCritical = criticalPaths.some(path => href.startsWith(path));
      const isCta = link.classList.contains('cta-primary') || link.classList.contains('login-btn');

      if (isCritical || isCta) {
          const loader = document.getElementById('global-loader');
          if (loader) loader.classList.remove('loader-hidden');
      }
  });

  document.addEventListener('submit', function(e) {
      const form = e.target;
      const action = form.getAttribute('action');
      const loader = document.getElementById('global-loader');
      
      if (!loader) return;

      const protectedActions = [
        '/login', 
        '/signup', 
        '/update-goal', 
        '/update-password', 
        '/clear-account-data'
      ];


      if (action && protectedActions.some(act => action.includes(act))) {
           if (form.checkValidity()) {
                loader.classList.remove('loader-hidden');
           }
      }
  });
</script>