<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Productivity Tracker</title>
  
  <link rel="preload" href="/css/style.css" as="style">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="icon" href="/images/icon.svg" type="image/svg+xml">
  
  <style>
    :root {
      --bg-dark: #050505;
      --glass-surface: rgba(20, 20, 20, 0.6);
      --glass-border: 1px solid rgba(255, 255, 255, 0.06);
      --neon-gold: #FFD700;
      --neon-blue: #00f2ea;
      --neon-red: #ff0055;
      --neon-purple: #bc13fe;
      --card-radius: 20px;
      --transition-fast: all 0.2s ease;
      --transition-smooth: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    

    body {
      background-color: var(--bg-dark);
      background-image: 
        radial-gradient(circle at 0% 0%, rgba(255, 215, 0, 0.05) 0%, transparent 40%),
        radial-gradient(circle at 100% 100%, rgba(0, 242, 234, 0.05) 0%, transparent 40%);
      background-attachment: fixed;
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
      color: #fff;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px 80px 20px;
    }

    .animate-up { animation: fadeSlideUp 0.6s ease-out forwards; opacity: 0; transform: translateY(20px);
    }
    .delay-1 { animation-delay: 0.1s; }
    .delay-2 { animation-delay: 0.2s;
    }
    .delay-3 { animation-delay: 0.3s; }
    
    @keyframes fadeSlideUp { to { opacity: 1;
      transform: translateY(0); } }

    /* --- 1. Header & Hero --- */
    .dashboard-hero {
      display: flex;
      justify-content: space-between; align-items: center;
      margin-bottom: 15px; flex-wrap: wrap; gap: 20px;
    }
    .hero-text h1 {
      font-size: 2.2rem; margin-bottom: 1px; font-weight: 800;
      color: #fff;
      letter-spacing: -0.5px;
    }
    .hero-text p { color: #999; font-size: 1rem;
    }

    .btn-log-session {
      background: #fff; color: #000; border: none;
      padding: 14px 30px;
      border-radius: 50px;
      font-weight: 700; font-size: 0.95rem;
      cursor: pointer; display: flex; align-items: center; gap: 10px;
      box-shadow: 0 0 25px rgba(255, 255, 255, 0.15);
      transition: var(--transition-fast);
    }
    .btn-log-session:hover { transform: translateY(-2px);
      box-shadow: 0 0 35px rgba(255, 255, 255, 0.3); }

    /* --- 2. Level & XP Card (Z-Index Fix) --- */
    .level-section {
      background: var(--glass-surface);
      border: var(--glass-border);
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      border-radius: var(--card-radius); padding: 30px;
      margin-bottom: 30px; 
      display: flex; align-items: center; gap: 30px;
      /* High Z-Index for Tooltip */
      position: relative; 
      z-index: 100; 
      overflow: visible;
    }

    .level-ring {
      position: relative; width: 85px; height: 85px; border-radius: 50%;
      background: conic-gradient(var(--neon-gold) 0deg, rgba(255,255,255,0.05) 0deg);
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.1);
      flex-shrink: 0;
    }
    .level-ring::after {
      content: ''; position: absolute; width: 75px;
      height: 75px;
      background: var(--bg-dark); border-radius: 50%;
    }
    .level-text { position: relative; z-index: 2; text-align: center; line-height: 1;
    }
    .lvl-num { font-size: 1.8rem; font-weight: 800; color: #fff; display: block;
    }
    .lvl-lbl { font-size: 0.7rem; color: var(--neon-gold); font-weight: 700; letter-spacing: 1px; text-transform: uppercase;
    }

    .xp-details { flex-grow: 1; }
    .xp-header { display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 12px; }
    
    .xp-pill {
      background: rgba(255, 215, 0, 0.08);
      border: 1px solid rgba(255, 215, 0, 0.2);
      padding: 6px 16px; border-radius: 12px;
      color: var(--neon-gold); font-weight: 700; font-size: 0.9rem;
      display: inline-flex;
      align-items: center; gap: 8px;
      cursor: pointer; transition: var(--transition-fast);
    }
    .xp-pill:hover { background: rgba(255, 215, 0, 0.15);
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.2); }

    .info-trigger {
      width: 28px;
      height: 28px; border-radius: 50%;
      background: rgba(255,255,255,0.1); color: #888;
      display: flex; align-items: center; justify-content: center;
      cursor: help; position: relative; transition: 0.2s;
    }
    .info-trigger:hover { background: rgba(255,255,255,0.2); color: #fff;
    }
    
    .tooltip-box {
      position: absolute; top: 40px;
      right: 0; width: 260px;
      background: #151515; border: 1px solid rgba(255,255,255,0.2);
      padding: 15px; border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.8);
      opacity: 0; visibility: hidden; transform: translateY(-10px);
      transition: all 0.2s ease; pointer-events: none;
      z-index: 9999;
    }
    .info-trigger:hover .tooltip-box { opacity: 1; visibility: visible; transform: translateY(0);
    }

    .xp-bar-bg { height: 8px; background: rgba(255,255,255,0.05); border-radius: 10px; overflow: hidden; margin-bottom: 8px;
    }
    .xp-bar-fill { height: 100%; background: linear-gradient(90deg, #FFD700, #ff9100); width: 0%;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.4); transition: width 1s ease-out;
    }

    /* --- 3. Main Grid --- */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr; gap: 25px; margin-bottom: 30px;
      position: relative; z-index: 1;
    }
    
    .card-panel {
      background: var(--glass-surface); border: var(--glass-border);
      border-radius: var(--card-radius); padding: 25px;
      display: flex; flex-direction: column;
    }

    .card-head { display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 20px; }
    .card-title { font-size: 1.1rem; font-weight: 700; display: flex; align-items: center; gap: 10px; color: #fff;
    }
    .card-title svg { color: var(--neon-blue); opacity: 0.9;
    }

    /* Focus Wheel */
    .focus-display { display: flex; flex-direction: column; align-items: center;
      justify-content: center; flex: 1; }
    .wheel-outer {
      width: 170px; height: 170px;
      border-radius: 50%;
      background: conic-gradient(#333 0deg, #333 360deg);
      display: flex; align-items: center; justify-content: center;
      position: relative; margin-bottom: 15px;
      box-shadow: 0 0 40px rgba(0,0,0,0.2);
    }
    .wheel-outer::after { content: ''; position: absolute; width: 140px; height: 140px;
      background: #121212; border-radius: 50%; }
    .wheel-inner { position: relative; z-index: 2; text-align: center;
    }
    .wheel-val { font-size: 2.5rem; font-weight: 800; line-height: 1; color: #fff;
    }
    .wheel-lbl { font-size: 0.75rem; color: #666; font-weight: 700; text-transform: uppercase; margin-top: 5px;
    }
    
    .goal-text-gradient {
      font-size: 1.25rem; font-weight: 800;
      background: linear-gradient(135deg, #fff 0%, #aaa 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      margin-bottom: 5px;
    }

    /* Momentum Chart */
    .chart-box { display: flex; justify-content: space-between; align-items: flex-end;
      height: 150px; gap: 12px; margin-top: auto; }
    .chart-col { flex: 1; display: flex; flex-direction: column; align-items: center;
      height: 100%; justify-content: flex-end; }
    .bar-wrapper { width: 100%; height: 100%; background: rgba(255,255,255,0.03); border-radius: 8px; position: relative;
      overflow: hidden; display: flex; align-items: flex-end; }
    .bar-fill { width: 100%; min-height: 4px;
      border-radius: 8px 8px 0 0; transition: height 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); }
    .bar-fill.high { background: #4ade80;
      box-shadow: 0 0 20px rgba(74, 222, 128, 0.25); }
    .bar-fill.med { background: #FFD700;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.25); }
    .bar-fill.low { background: #ef4444;
    }
    .col-label { margin-top: 10px; font-size: 0.8rem; font-weight: 600; color: #777;
    }
    .col-val { font-size: 0.85rem; font-weight: 700; margin-bottom: 8px; color: #fff;
    }

    /* --- 4. Streak Stats --- */
    .streak-deck {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px;
      margin-bottom: 30px; position: relative; z-index: 1;
    }
    .streak-card {
      background: linear-gradient(145deg, rgba(30,30,30,0.6), rgba(10,10,10,0.8));
      border: 1px solid rgba(255,255,255,0.05);
      border-radius: 18px; padding: 20px;
      display: flex; align-items: center; gap: 15px;
      transition: var(--transition-fast);
    }
    .streak-card:hover { transform: translateY(-4px);
      border-color: rgba(255,255,255,0.1); }
    
    .s-icon { width: 45px; height: 45px; border-radius: 12px; display: flex;
      align-items: center; justify-content: center; font-size: 1.3rem; flex-shrink: 0; }
    .si-fire { background: rgba(255, 87, 34, 0.15);
      color: #ff5722; }
    .si-star { background: rgba(255, 215, 0, 0.15); color: #FFD700;
    }
    .si-trophy { background: rgba(188, 19, 254, 0.15); color: #bc13fe;
    }
    .si-crown { background: rgba(0, 242, 234, 0.15); color: #00f2ea;
    }

    .s-data h4 { font-size: 0.75rem; color: #888; text-transform: uppercase; margin-bottom: 3px; font-weight: 700;
    }
    .s-data .num { font-size: 1.5rem; font-weight: 800; color: #fff;
    }

    /* --- 5. Bottom Section --- */
    .bottom-split {
      display: grid;
      grid-template-columns: 2fr 1fr; gap: 25px; position: relative; z-index: 1;
    }

    .log-list { list-style: none; margin-top: 10px;
    }
    .log-entry {
      display: flex; justify-content: space-between; align-items: center;
      padding: 16px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .log-entry:last-child { border-bottom: none; }
    .le-left { display: flex;
      align-items: center; gap: 15px; }
    .date-sq {
      background: #1a1a1a;
      border: 1px solid #333; padding: 5px 10px; border-radius: 10px;
      text-align: center; min-width: 55px;
    }
    .ds-mo { font-size: 0.65rem; color: #777; text-transform: uppercase; display: block; font-weight: 700;
    }
    .ds-dy { font-size: 1.1rem; font-weight: 800; color: #fff;
    }
    
    .le-info-h { font-size: 1rem; font-weight: 700; color: #eee;
    }
    .le-info-status { font-size: 0.75rem; display: flex; align-items: center; gap: 6px; margin-top: 4px; font-weight: 600;
    }
    .status-dot { width: 6px; height: 6px; border-radius: 50%; }

    .action-panel { display: flex;
      flex-direction: column; gap: 15px; }

    .total-stat-box {
      background: linear-gradient(135deg, #181818, #0a0a0a);
      border: 1px solid rgba(255, 215, 0, 0.1);
      border-radius: 18px; padding: 20px; text-align: center;
    }
    .ts-label { font-size: 0.75rem; color: #888; text-transform: uppercase; letter-spacing: 1px;
    }
    .ts-val { font-size: 2.2rem; font-weight: 800; color: var(--neon-gold); margin-top: 5px;
    }

    /* Achievement Hero Button */
    .btn-hero-achieve {
      background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,165,0,0.05));
      border: 1px solid rgba(255, 215, 0, 0.4);
      padding: 20px; border-radius: 16px;
      display: flex; align-items: center; justify-content: space-between;
      text-decoration: none;
      color: #fff;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.1);
      transition: var(--transition-smooth);
      position: relative; overflow: hidden;
    }
    .btn-hero-achieve:hover {
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.25);
      border-color: var(--neon-gold);
      transform: translateY(-2px);
    }
    .hero-content { display: flex; align-items: center; gap: 12px;
    }
    .hero-icon { font-size: 1.5rem; }
    .hero-text-main { font-size: 1.2rem; font-weight: 800; color: var(--neon-gold);
    }
    .hero-text-sub { font-size: 0.8rem; color: #aaa; margin-top: 2px; }
    .hero-arrow { color: var(--neon-gold);
      font-size: 1.2rem; }
    
    .btn-secondary {
      background: var(--glass-surface);
      border: var(--glass-border);
      padding: 15px 20px; border-radius: 14px;
      display: flex; align-items: center; justify-content: space-between;
      text-decoration: none; color: #ccc; transition: var(--transition-fast);
      font-weight: 600;
    }
    .btn-secondary:hover { background: rgba(255,255,255,0.08); color: #fff; transform: translateX(3px);
    }

    /* Responsive */
    @media (max-width: 900px) { .dashboard-grid, .bottom-split { grid-template-columns: 1fr; } }
    
    @media (max-width: 600px) { 
      .container { padding: 0 15px 80px 15px; }
      .streak-deck { grid-template-columns: 1fr 1fr; gap: 10px; }
      .streak-card { padding: 15px; flex-direction: column; text-align: center; gap: 10px; }
      .s-data { width: 100%; display: flex; flex-direction: column; align-items: center; }
      .hero-text h1 { font-size: 1.8rem; }
    }
  </style>
</head>
<body>
  <%- include('partials/loader') %>
  
  <nav class="navbar">
    <h2>Productivity Tracker</h2>
    <div class="nav-links">
      <a href="/dashboard" class="active">Dashboard</a>
      <a href="/calendar">‚≠êÔ∏è Calendar</a>
      <a href="/analytics">Analytics</a>
      <a href="/settings">Settings</a>
      <a href="/logout">Logout</a>
    </div>
  </nav>

  <div class="container">
    
    <div class="dashboard-hero">
      <div class="hero-text">
        <h1 >Welcome, <%= user.name %></h1>
    
        <p>Ready to level up your productivity today?</p>
      </div>
      <button id="open-track-modal" class="btn-log-session">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg>
        Log Study Hours
      </button>
    </div>

    <% 
        const XP_PER_LEVEL = 
        1000;
        const currentLevelXp = user.xp % XP_PER_LEVEL;
        const progressPercent = (currentLevelXp / XP_PER_LEVEL) * 100;
        const circleDeg = (currentLevelXp / XP_PER_LEVEL) * 360;
    %>
    <div class="level-section animate-up delay-1">
      <div class="level-ring" style="background: conic-gradient(var(--neon-gold) <%= circleDeg %>deg, rgba(255,255,255,0.05) 0deg);">
         <div class="level-text">
            <span class="lvl-num"><%= user.level %></span>
            <span class="lvl-lbl">LEVEL</span>
         </div>
      </div>

      <div class="xp-details">
         <div class="xp-header">
 
           <div class="xp-pill" id="xp-counter">
               <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/></svg>
               <span class="animate-num" data-suffix=" XP"><%= user.xp %> XP</span>
            </div>
            
         
           <div class="info-trigger">
               i
               <div class="tooltip-box">
                  <h4 style="color:var(--neon-gold);
                  margin-bottom:8px; font-size:0.9rem;">XP Rules</h4>
                  <ul style="padding-left:15px;
                  font-size:0.8rem; color:#bbb; line-height:1.6;">
                     <li>+10 XP per hour studied</li>
                     <li>+50 XP for meeting daily goal</li>
                     <li>+100 XP per each new achievement</li>
                     
                  *Levels increase every 1000 XP, reward yourself !
                  </ul>
               </div>
            </div>
         </div>
         
         <div class="xp-bar-bg">
            <div class="xp-bar-fill" id="xp-progress-fill" data-width="<%= progressPercent %>"></div>
   
         </div>
         <div style="display:flex; justify-content:space-between; font-size:0.8rem;
         color:#666;">
            <span>Current Progress</span>
            <span><%= currentLevelXp %> / <%= XP_PER_LEVEL %> XP</span>
         </div>
      </div>
    </div>

    <%
      const goal = user.dailyGoalHours;
      let focusColor = '#ef4444'; 
      if (todayHours >= goal) focusColor = '#4ade80'; 
      else if (todayHours > 0) focusColor = 
      '#FFD700';

      const percentage = Math.round((todayHours / goal) * 100);
      const focusDeg = Math.min((todayHours / goal) * 360, 360);
      
      let percentageText = percentage + "% Complete";
      if(percentage >= 100) percentageText = percentage + "% (Goal Met)";
      if(percentage === 0) percentageText = "0% Started";
    %>
    <div class="dashboard-grid animate-up delay-2">
       <div class="card-panel">
         
         <div class="card-head">
             <div class="card-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/><path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/></svg>
                Today's Focus
 
             </div>
             <span style="font-size:0.9rem;
             color:#888;">Goal: <%= goal %>h</span>
          </div>
          
          <div class="focus-display">
             <div class="wheel-outer" style="background: conic-gradient(<%= focusColor %> <%= focusDeg %>deg, #1c1c1c 0deg);">
                <div class="wheel-inner">
                   <div class="wheel-val" style="color: <%= focusColor %>"><%= todayHours.toFixed(1) 
                   %></div>
                   <div class="wheel-lbl">HOURS</div>
                </div>
             </div>
             <div class="goal-text-gradient"><%= percentageText %></div>
          </div>
       </div>

       <% 
         const 
         getMomentum = () => {
           const history = [];
           const now = new Date();
           const todayUTC = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate()));
           const g = user.dailyGoalHours || 5; 

           for(let i=3; i>=1; i--) {
              const d = new 
              Date(todayUTC);
              d.setUTCDate(d.getUTCDate() - i);
              
              // Safe date comparison
              const log = recentLogs.find(l => {
                  const ld = new Date(l.date);
                  return ld.getUTCFullYear() === d.getUTCFullYear() &&
                         ld.getUTCMonth() === d.getUTCMonth() &&
                         ld.getUTCDate() === d.getUTCDate();
              });

              const h = log ? log.hours : 0;
              let status = 'low';
              if(h >= g) status = 'high';
              else if(h > 0) status = 'med';
              
              // Calculate specific percentages
              const rawPct = (h / g) * 100;
              const visualPct = Math.min(rawPct, 100); 
              const displayPct = Math.round(rawPct);

              history.push({ 
                 day: d.toLocaleDateString('en-US', { weekday: 'short' }),
                 hours: h, 
                 status,
                 visualPct, // For CSS height (max 100%)
         
                 displayPct // For text label (can exceed 100%)
              });
           }
           return history;
         };
         const momentumData = getMomentum();
       %>
       <div class="card-panel">
          <div class="card-head">
             <div class="card-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0z"/><path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 
                1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/></svg>
                Momentum
             </div>
             <a href="/calendar" style="font-size:0.85rem; color:var(--neon-gold); text-decoration:none;">Calendar ‚Üí</a>
          </div>
          
       
          <div class="chart-box">
             <% momentumData.forEach(day => { %>
               <div class="chart-col">
                  <span class="col-val"><%= day.hours.toFixed(1) %>h (<%= day.displayPct %>%)</span>
                  <div class="bar-wrapper">
           
                      <div class="bar-fill <%= day.status %>" style="height: <%= day.visualPct === 0 ?
                      5 : day.visualPct %>%;"></div>
                  </div>
                  <span class="col-label"><%= day.day %></span>
               </div>
             <% }) %>
          </div>
       </div>
    </div>

    <div class="streak-deck animate-up 
    delay-3">
        <div class="streak-card">
           <div class="s-icon si-fire">üî•</div>
           <div class="s-data">
             <h4>Current Consistency</h4>
             <div class="num animate-num" data-suffix=" days"><%= currentConsistencyStreak %> days</div>
           </div>
        </div>
        <div class="streak-card">
    
           <div class="s-icon si-star">‚≠êÔ∏è</div>
           <div class="s-data">
             <h4>Current Goal Streak</h4>
             <div class="num animate-num" data-suffix=" days"><%= currentGoalStreak %> days</div>
           </div>
        </div>
        <div class="streak-card">
           <div class="s-icon si-trophy">üèÜ</div>
   
           <div class="s-data">
             <h4>Max Consistency Streak</h4>
             <div class="num animate-num" data-suffix=" days"><%= maxConsistencyStreak %> days</div>
           </div>
        </div>
        <div class="streak-card">
           <div class="s-icon si-crown">üíé</div>
           <div class="s-data">
   
             <h4>Best Goal Streak</h4>
             <div class="num animate-num" data-suffix=" days"><%= maxGoalStreak %> days</div>
           </div>
        </div>
    </div>

    <div class="bottom-split animate-up delay-3">
       <div class="card-panel">
          <div class="card-head">
             <div class="card-title">Recent Activity</div>
    
             <a href="/analytics" style="color: #888;
             font-size: 0.85rem;">view full analytics -></a>
          </div>
          
          <ul class="log-list">
             <% if (recentLogs.length > 0) { %>
               <% recentLogs.slice(0, 5).forEach(log => { 
                   const d = new Date(log.date);
   
                   const isMet = log.hours >= user.dailyGoalHours;
               %>
               <li class="log-entry">
                  <div class="le-left">
                     <div class="date-sq">
       
                        <span class="ds-mo"><%= d.toLocaleDateString('en-US', {month:'short'}) %></span>
                        <span class="ds-dy"><%= d.getDate() %></span>
                     </div>
                     <div>
          
                        <div class="le-info-h"><%= log.hours.toFixed(1) %> Hours</div>
                        <div class="le-info-status" style="color: <%= isMet ? '#4ade80' : '#ef4444' %>">
                           <div class="status-dot" style="background: <%= isMet ? '#4ade80' : '#ef4444' %>"></div>
             
                           <%= isMet ?
                           'Goal Met' : 'Below Goal' %>
                        </div>
                     </div>
                  </div>
               </li>
               <% }) 
               %>
             <% } else { %>
               <li style="text-align:center; color:#555; padding:20px;">No logs recorded yet.</li>
             <% } %>
          </ul>
       </div>

       <div class="action-panel">
          
          <div class="total-stat-box">
 
             <div class="ts-label">All Time Working Hours</div>
             <div class="ts-val animate-num" data-suffix="h"><%= totalHours.toFixed(1) %>h</div>
          </div>

          <a href="/achievements" class="btn-hero-achieve">
             <div class="hero-content">
                <span class="hero-icon">üèÜ</span>
             
               <div>
                   <div class="hero-text-main">Achievements</div>
                   <% if(achievementCount > 0) { %>
                     <div class="hero-text-sub" style="color:#ff5722;"><%= achievementCount %> Unclaimed!</div>
                   <% } else { %>
    
                     <div class="hero-text-sub">View Progress</div>
                   <% } %>
                </div>
             </div>
             <span class="hero-arrow">‚Üí</span>
          </a>
       
          
          <a href="/settings" class="btn-secondary">
             <span>‚öôÔ∏è Update Goal Hours</span>
             <span>‚Üí</span>
          </a>

       </div>
    </div>

  </div> <div id="trackModal" class="modal-overlay">
    <div class="modal-content">
        <span class="modal-close" id="close-track-modal">&times;</span>
        <h2 style="text-align: center;
        margin-bottom: 20px; color: #ffd700;">Add Study Hours</h2>
        <form id="quickLogForm">
            <div class="form-group" style="margin-bottom: 15px;">
                <label for="modal-date">Date</label>
                <input type="date" id="modal-date" name="date" required style="width: 100%;
                padding: 12px; background: #2a2a2a; border: 1px solid #444; color: white; border-radius: 8px;
                box-sizing: border-box;">
            </div>
            <div class="form-group" style="margin-bottom: 25px;">
                <label for="modal-hours">Hours Studied</label>
                <input type="number" id="modal-hours" name="hours" step="0.5" min="0" max="24" required style="width: 100%;
                padding: 12px; background: #2a2a2a; border: 1px solid #444; color: white; border-radius: 8px;
                box-sizing: border-box;">
            </div>
            <button type="submit" class="btn" style="width: 100%;
            font-size: 1.1rem; padding: 12px;">Save Log</button>
        </form>
    </div>
  </div>

  <div id="xp-history-popup" class="xp-popup">
      <div class="xp-popup-content">
        <span class="xp-popup-close" id="xp-popup-close">&times;</span>
        <h2>XP Credit History</h2>
        <div id="xp-history-list" class="xp-history-list"></div>
      </div>
  </div>
      <footer style="padding: 50px 15px;text-align: center;border-top: 1px solid var(--border-light);">
        <p style="color: #666;">&copy; 2025 TrackU. All rights reserved. <a href="mailto:tracku.contact@gmail.com" style="color:rgb(115, 115, 115);">Message our suggestion/queries</a></p>
    </footer>

  <script src="/js/achievements.js" defer></script>
  <script>
    // Modal & Form Logic
    const trackModal = document.getElementById('trackModal');
    const openTrackBtn = document.getElementById('open-track-modal');
    const 
    closeTrackBtn = document.getElementById('close-track-modal');
    const quickLogForm = document.getElementById('quickLogForm');
    const modalDate = document.getElementById('modal-date');
    
    openTrackBtn.addEventListener('click', () => {
        trackModal.style.display = 'flex';
        modalDate.value = new Date().toISOString().split('T')[0];
    });
    closeTrackBtn.addEventListener('click', () => { trackModal.style.display = 'none';
    });
    
    window.addEventListener('click', (e) => {
        if (e.target === trackModal) trackModal.style.display = 'none';
        const xpPopup = document.getElementById('xp-history-popup');
        if (e.target === xpPopup) xpPopup.style.display = 'none';
    });
    quickLogForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const submitBtn = quickLogForm.querySelector('button');
        const originalText = submitBtn.innerText;
        submitBtn.innerText = "Saving...";
        submitBtn.disabled = true;
        const formData = new URLSearchParams(new FormData(quickLogForm));
        try {
            await fetch('/add-study-log', {
          
                method: 'POST',
                body: formData,
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
            });
            window.location.reload(); 
        } catch (err) {
            console.error(err);
        
            alert('Failed to save log');
            submitBtn.innerText = originalText;
            submitBtn.disabled = false;
        }
    });
    // XP Popup Logic
    const xpCounter = document.getElementById('xp-counter');
    const xpPopup = document.getElementById('xp-history-popup');
    const xpPopupClose = document.getElementById('xp-popup-close');
    const xpHistoryList = document.getElementById('xp-history-list');
    
    if(xpCounter) {
        xpCounter.addEventListener('click', async () => {
          try {
            const response = await fetch('/api/xp-history');
            const data = await response.json();
            let html = '<h3>Achievements</h3><ul>';
            if (data.achievements.length > 0) { data.achievements.forEach(item => { html += `<li>${item}</li>`; }); } 
            
            else { html += '<li>No achievement XP earned yet.</li>'; }
            html += '</ul><h3>Study Logs</h3><ul>';
            if (data.logs.length > 0) { data.logs.forEach(item => { html += `<li>${item}</li>`; }); } 
            else { html += '<li>No study XP earned yet.</li>'; }
            html += '</ul>';
    
            xpHistoryList.innerHTML = html;
            xpPopup.style.display = 'block';
          } catch (error) {
            console.error('Failed to fetch XP history:', error);
            xpHistoryList.innerHTML = '<p>Could not load XP history.</p>';
            xpPopup.style.display = 'block';
          }
    
        });
    }
    if(xpPopupClose) {
        xpPopupClose.addEventListener('click', () => { xpPopup.style.display = 'none'; });
    }

    // Animations
    document.addEventListener('DOMContentLoaded', () => {
        const xpFill = document.getElementById('xp-progress-fill');
        if(xpFill) {
            setTimeout(() => {
                const targetWidth = xpFill.getAttribute('data-width');
                xpFill.style.width = targetWidth + '%';
            }, 300); 
 
        }

        const stats = document.querySelectorAll('.animate-num');
        stats.forEach(stat => {
            const originalText = stat.innerText;
            const suffix = stat.getAttribute('data-suffix') || '';
            const target = parseFloat(originalText.replace(/[^0-9.]/g, ''));
            if (isNaN(target)) return;
          
            let start = 0;
            const duration = 1500;
            const startTime = performance.now();

            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
        
                const easeOut = 1 - Math.pow(1 - progress, 3);
                const current = start + (target - start) * easeOut;
                
                if (originalText.includes('.')) { stat.innerText = current.toFixed(1) + suffix;
                } 
                else { stat.innerText = Math.floor(current) + suffix;
                }
                
                if (progress < 1) { requestAnimationFrame(update);
                } 
                else { stat.innerText = originalText;
                }
            }
            setTimeout(() => requestAnimationFrame(update), 100);
        });
    });
  </script>
</body>
</html>